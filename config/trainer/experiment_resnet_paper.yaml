# Experiment: ResNet generator (CycleGAN/Johnson paper)

_base_: "base.yaml"

run_name: "monet-resnet-paper"
description: "ResNet generator with reflection padding and transposed-conv decoder (CycleGAN paper)"

s3:
  prefix: "monet-gan/models/resnet-paper"

wandb:
  tags:
    - "cyclegan"
    - "resnet"
    - "paper"
    - "instancenorm"

generator:
  encoder:
    # c7s1-64
    - type: conv
      in_channels: 3
      out_channels: 64
      kernel_size: 7
      stride: 1
      padding: 3
      padding_mode: reflect
      norm: instance
      activation: relu
    # d128
    - type: conv
      in_channels: 64
      out_channels: 128
      kernel_size: 3
      stride: 2
      padding: 1
      padding_mode: reflect
      norm: instance
      activation: relu
    # d256
    - type: conv
      in_channels: 128
      out_channels: 256
      kernel_size: 3
      stride: 2
      padding: 1
      padding_mode: reflect
      norm: instance
      activation: relu

  bottleneck:
    # R256 x9 for 256x256 training (use 6 blocks for <=128)
    - type: residual
      channels: 256
      kernel_size: 3
      padding_mode: reflect
      norm: instance
      activation: relu
      dropout: 0.0
    - type: residual
      channels: 256
      kernel_size: 3
      padding_mode: reflect
      norm: instance
      activation: relu
      dropout: 0.0
    - type: residual
      channels: 256
      kernel_size: 3
      padding_mode: reflect
      norm: instance
      activation: relu
      dropout: 0.0
    - type: residual
      channels: 256
      kernel_size: 3
      padding_mode: reflect
      norm: instance
      activation: relu
      dropout: 0.0
    - type: residual
      channels: 256
      kernel_size: 3
      padding_mode: reflect
      norm: instance
      activation: relu
      dropout: 0.0
    - type: residual
      channels: 256
      kernel_size: 3
      padding_mode: reflect
      norm: instance
      activation: relu
      dropout: 0.0
    - type: residual
      channels: 256
      kernel_size: 3
      padding_mode: reflect
      norm: instance
      activation: relu
      dropout: 0.0
    - type: residual
      channels: 256
      kernel_size: 3
      padding_mode: reflect
      norm: instance
      activation: relu
      dropout: 0.0
    - type: residual
      channels: 256
      kernel_size: 3
      padding_mode: reflect
      norm: instance
      activation: relu
      dropout: 0.0

  decoder:
    # u128
    - type: upsample_conv
      in_channels: 256
      out_channels: 128
      kernel_size: 3
      scale_factor: 2
      mode: bilinear
      norm: instance
      activation: relu
    # u64
    - type: upsample_conv
      in_channels: 128
      out_channels: 64
      kernel_size: 3
      scale_factor: 2
      mode: bilinear
      norm: instance
      activation: relu

  output:
    # c7s1-3
    - type: conv
      in_channels: 64
      out_channels: 3
      kernel_size: 7
      stride: 1
      padding: 3
      padding_mode: reflect
      norm: none
      activation: none

  # ResNet generator does not use skip connections
  skip_connections: []


discriminator:
  type: patchgan
  input_channels: 3
  base_channels: 64
  num_layers: 3
  kernel_size: 4
  norm: instance
  activation: leaky_relu
  use_sigmoid: false

optimizer:
  generator:
    type: adam
    lr: 0.0002
    betas: [0.0, 0.9]
  
  discriminator:
    type: adam
    lr: 0.0002
    betas: [0.0, 0.9]

losses:
  gan_mode: wgan-gp
  cycle_loss_type: l1
  identity_loss_type: l1
  
  weights:
    adversarial: 1.0
    cycle: 10.0
    identity: 5.0
    perceptual: 1.0
    gradient_penalty: 10.0
